Ecco il prompt finale aggiornato, chiaro e definitivo, con evidenziata la distinzione cruciale sui Leads per Replit, basato sulla tua indicazione. Questo testo √® pronto da inviare direttamente a Replit:

‚∏ª

üö© Prompt finale aggiornato per lo sviluppo e debug di Experviser CRM

üéØ Obiettivo Principale

Realizzare rapidamente un CRM robusto e scalabile, specializzato per consulenti o piccoli team nei settori Franchising, Retail, e Ristorazione, focalizzandosi subito su stabilit√† backend, integrit√† logica dei dati e correttezza delle funzioni principali. L‚Äôinterfaccia grafica pu√≤ essere ottimizzata successivamente.

‚∏ª

üìå Indicazioni aggiuntive immediate (Cruciali)

Eccezione Critica:
	‚Ä¢	Leads (essendo dati temporanei, non validati) sono l‚Äôunica entit√† cancellabile definitivamente (operazione di DELETE fisico, non archiviazione).
	‚Ä¢	Tutte le altre entit√† principali (Deals, Contacts, Contact Emails) prevedono invece l‚Äôarchiviazione, mai la cancellazione fisica.

‚∏ª

‚úÖ Task Principali (Aggiornati con precisazione sui Leads)

1Ô∏è‚É£ üì• Sistema di Archiviazione Dati (ad eccezione dei Leads)
	‚Ä¢	Implementazione Archiviazione:
	‚Ä¢	status (enum 'active' | 'archived') o isArchived (boolean) per Deals, Contacts e Contact Emails.
	‚Ä¢	MAI eliminare fisicamente record di queste entit√† (solo archiviarli).
	‚Ä¢	Endpoint API DELETE per queste entit√† devono invece effettuare un‚Äôarchiviazione (isArchived=true).
	‚Ä¢	Gestione dei Leads (Eccezione):
	‚Ä¢	Endpoint API DELETE (/api/leads/:id) deve eliminare fisicamente il record dal database.
	‚Ä¢	Conversione dei Leads (POST /api/leads/:id/convert) comporta sempre eliminazione fisica del Lead originale dopo conversione.
	‚Ä¢	Sinergie:
	‚Ä¢	Le sinergie restano collegate ai Deal anche se archiviati (non subiscono modifiche in caso di archivio).

‚∏ª

2Ô∏è‚É£ üìß Gestione Avanzata Email per Contatto
	‚Ä¢	Gestire pi√π indirizzi email per ciascun contatto (tabella contact_emails).
	‚Ä¢	Campi: id, contactId, emailAddress, type (work, personal, previous_work, other), isPrimary, isArchived, createdAt, updatedAt.
	‚Ä¢	Eliminare campi companyEmail e privateEmail da tabella contacts.
	‚Ä¢	Associazione automatica email verifica su tutti gli indirizzi email non archiviati.

‚∏ª

3Ô∏è‚É£ ‚≠êÔ∏è Aziende ‚ÄúActive Rep‚Äù (Rapporto Contrattuale in Corso)
	‚Ä¢	Campo booleano isActiveRep (default false) nella tabella companies.
	‚Ä¢	UI dedicata in dashboard per mostrare esclusivamente aziende ‚ÄúActive Rep‚Äù.
	‚Ä¢	Lista generale aziende filtra per default su isActiveRep=false (con filtro opzionale).

‚∏ª

4Ô∏è‚É£ üîñ Implementazione Best Practice CRM (ispirate a HubSpot, Pipedrive, ClozeCRM)
	‚Ä¢	Date Chiave:
	‚Ä¢	Aggiungere lastContactedAt, nextFollowUpAt per Contacts e Deals.
	‚Ä¢	Attivit√†:
	‚Ä¢	Timeline dettagliata e filtrabile per tipo attivit√† (email, meeting, note, update).
	‚Ä¢	Tagging Consistente:
	‚Ä¢	Campi multi-tag (brands, channels, productsOrServicesTags, locationTypes in companies; roles in contacts), con gestione autocompletamento e creazione dinamica nuovi tag.
	‚Ä¢	Tipi Azienda Strutturati:
	‚Ä¢	Campo companyType enum: (Indipendente, Basket Company Franchisor, Franchisor Monomarca, Multi-unit Franchisee, Master Franchisee, Gestore Centri Commerciali, Produttore, Grossista, Altro).
	‚Ä¢	Tipologie di Location:
	‚Ä¢	Campo multi-tag locationTypes (es. strade urbane, centri commerciali, travel retail).

‚∏ª

5Ô∏è‚É£ üîÑ Sinergie (URGENTE: FIX e rifacimento input)
	‚Ä¢	Casella ‚ÄúSynergy Contact‚Äù in DealModal:
	‚Ä¢	Ricerca con autocompletamento (async-select), caricamento dinamico dopo digitazione almeno 1 carattere.
	‚Ä¢	Escludere automaticamente contatti gi√† affiliati all‚Äôazienda del deal corrente.
	‚Ä¢	Selezione multipla obbligatoria con visualizzazione contatti scelti tramite tag blu, rimovibili con icona ‚Äúx‚Äù.
	‚Ä¢	Campo form React-hook-form: synergyContactIds (array di ID).
	‚Ä¢	Regole Sinergie:
	‚Ä¢	Nessuna cancellazione UI diretta delle Sinergie.
	‚Ä¢	Visualizzazione sinergie nella scheda azienda e contatto con link diretto al Deal associato.
	‚Ä¢	Eliminare tutte le false relazioni precedentemente generate per errore.

‚∏ª

6Ô∏è‚É£ üõ°Ô∏è Pannello di Controllo Superadmin (Nuova funzionalit√†)
	‚Ä¢	Riservato a utenti ruolo super_admin.
	‚Ä¢	Gestione utenti: creazione, modifica, archiviazione (senza eliminazione fisica).
	‚Ä¢	Utilizzare API sicure (es. GET /api/users, POST /api/users, PATCH /api/users/:id).

‚∏ª

‚öôÔ∏è Azioni Immediate per Replit

Replit deve effettuare autonomamente, senza ulteriori domande o interruzioni:
	‚Ä¢	Debug completo e risoluzione immediata di tutti i bug presenti.
	‚Ä¢	Implementazione immediata delle nuove funzionalit√† richieste (Task 1-6).
	‚Ä¢	Assicurare massima priorit√† alla correttezza logica e stabilit√† backend.
	‚Ä¢	Simulare tutte le azioni utente possibili (CRUD e archivio per contatti, aziende, deals, cancellazione fisica per i leads, gestione sinergie e email multiple, gestione aziende ‚ÄúActive Rep‚Äù, pannello superadmin).
	‚Ä¢	Verifica finale esaustiva e autonoma con test completo (logica dati, funzionalit√† e integrazioni).

‚∏ª

üóÉÔ∏è Schema Database - Chiarimenti Finali (Drizzle ORM)

Verificare che tutte le modifiche dello schema siano applicate prima di procedere:
	‚Ä¢	Archiviazione: Aggiungere campi status/isArchived (deals, contacts, contact_emails).
	‚Ä¢	Leads: Nessun campo archiviazione (DELETE fisico).
	‚Ä¢	Nuova tabella contact_emails.
	‚Ä¢	Campi isActiveRep, lastContactedAt, nextFollowUpAt per rispettive entit√†.
	‚Ä¢	Campi strutturati e multi-tag (vedi Task 4).

‚∏ª

üîÑ Reset e Seed iniziale Database (Cruciale prima dei test)
	‚Ä¢	Reset totale database (eccetto utente admin michele@experviser.com, da preservare sempre con ruolo super_admin e credenziali note).
	‚Ä¢	Nuovo seed minimo per test coerenti:
	‚Ä¢	2 aziende (una Active Rep, una standard), 2-3 contatti collegati con email multiple, 2 lead, 1-2 deal, nessuna sinergia iniziale.

‚∏ª

üí° Possibili sviluppi futuri (solo per riferimento, da non fare ora)
	‚Ä¢	Integrazione Google Maps API per verifica indirizzi aziendali.
	‚Ä¢	Parsing automatico email in ingresso.
	‚Ä¢	Integrazione futura Google Calendar e Apple Calendar.

‚∏ª

üö® ATTENZIONE CRITICA PER REPLIT
	‚Ä¢	Procedere immediatamente senza ulteriori richieste.
	‚Ä¢	Confermare esecuzione al termine con breve report finale contenente:
	1.	Conferma completamento schema, reset, implementazioni Task 1-6.
	2.	Riepilogo sintetico bug risolti.
	3.	Panoramica implementazioni verificate e funzionanti al 100%.

‚∏ª

‚úÖ Questo testo √® definitivo, pronto per l‚Äôimmediata esecuzione da parte di Replit.
L‚ÄôAI proceder√† con massima priorit√† e autonomia finch√© tutto non sar√† risolto e verificato.